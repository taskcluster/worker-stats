{"version":3,"file":"task_list.js","sources":["@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/9","static/src/view/task_list.js","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/8"],"names":[],"mappings":"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","sourcesContent":["define($__placeholder__0, $__placeholder__1);","function($__placeholder__0) {\n      $__placeholder__1\n    }","var __moduleName = $__placeholder__0;","var $__default = $__placeholder__0","function() {\n        var $__placeholder__0 = $__placeholder__1;\n        return ($traceurRuntime.createClass)($__placeholder__2, $__placeholder__3,\n                                             $__placeholder__4);\n      }()","/* jshint esnext: true */\n\nexport default class TaskListView {\n  constructor(element, itemHeight=100) {\n    // must be scrollable or really bad things happen\n    this.element = element;\n    this.itemHeight = itemHeight;\n    this.itemsInDOM = [];\n\n    // get the template\n    this.itemTemplate = element.querySelector('.task');\n    this.itemTemplate.parentNode.removeChild(this.itemTemplate);\n\n    var update = this.update.bind(this);\n    window.addEventListener('scroll', update);\n    window.addEventListener('resize', update);\n  }\n\n  setList(list) {\n    this.list = list;\n    var height = `${this.itemHeight * list.length}px`;\n    this.element.style.height = height;\n  }\n\n  getScrollPos() {\n    return document.documentElement.scrollTop;\n    //return this.element.scrollTop;\n  }\n\n  getScrollPortHeight() {\n    return window.innerHeight;\n    //return this.element.clientHeight;\n  }\n\n  populateItem(element, task) {\n    var link = element.querySelector('a');\n    link.href =\n      `log.html?RowKey=${task.RowKey}&PartitionKey=${task.PartitionKey}`;\n    link.textContent = task.taskUrl;\n  }\n\n  renderArea(displayPortMarginMultiplier) {\n    var scrollPos = this.getScrollPos();\n    var scrollPortHeight = window.innerHeight;\n    var itemsInDOM = this.itemsInDOM;\n    var itemHeight = this.itemHeight;\n    var numberOfItems = this.list.length;\n    var template = this.itemTemplate;\n\n    // Determine which items we *need* to have in the DOM. displayPortMargin\n    // is somewhat arbitrary. If there is fast async scrolling, increase\n    // displayPortMarginMultiplier to make sure more items can be prerendered. If\n    // populateItem triggers slow async activity (e.g. image loading or\n    // database queries to fill in an item), increase displayPortMarginMultiplier\n    // to reduce the likelihood of the user seeing incomplete items.\n    var displayPortMargin = displayPortMarginMultiplier * scrollPortHeight;\n    var startDiff =\n      Math.floor((scrollPos - displayPortMargin) / itemHeight);\n    var startIndex = Math.max(0, startDiff);\n\n    var endDiff = Math.ceil(\n      (scrollPos + scrollPortHeight + displayPortMargin) / itemHeight\n    );\n    var endIndex = Math.min(numberOfItems, endDiff);\n\n    // indices of items which are eligible for recycling\n    var recyclableItems = [];\n    for (var i in itemsInDOM) {\n      if (i < startIndex || i >= endIndex) {\n        recyclableItems.push(i);\n      }\n    }\n    // Put the items that are furthest away from the displayport at the end of\n    // the array.\n    function distanceFromDisplayPort(i) {\n      return i < startIndex ? startIndex - 1 - i : i - endIndex;\n    }\n    recyclableItems.sort(function (a,b) {\n      return distanceFromDisplayPort(a) - distanceFromDisplayPort(b);\n    });\n\n    for (var i = startIndex; i < endIndex; ++i) {\n      if (itemsInDOM[i]) {\n        continue;\n      }\n      var item;\n      if (recyclableItems.length > 0) {\n        var recycleIndex = recyclableItems.pop();\n        item = itemsInDOM[recycleIndex];\n        delete itemsInDOM[recycleIndex];\n      } else {\n        item = template.cloneNode(true);\n        this.element.appendChild(item);\n      }\n\n      this.populateItem(item, this.list[i]);\n      item.style.top = `${i * itemHeight}px`;\n      itemsInDOM[i] = item;\n    }\n  }\n\n  update() {\n    // Synchronously generate all the items that are immediately or nearly visible\n    this.renderArea(1);\n    // Asynchronously generate the other items for the displayport\n    setTimeout(() => this.renderArea(4));\n  }\n}\n","return $__placeholder__0","get $__placeholder__0() { return $__placeholder__1; }","__transpiledModule: true"]}